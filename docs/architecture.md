# Моделирование системы

## Логическая модель данных

Диаграмма отражает весь комплекс сущностей, участвующих в процессе, включая меню с сезонным фактором, корзину, состав товаров, систему лояльности, возмодности оплаты и др.

![](diagrams/DataModel.png)

## Архитектура системы

Архитектурная диаграмма отражаеи все компоненты системы. За границей контура системы находятся компоненты с которыми система интегрирована для осуществления функци оплаты, складского хранения, уведомления, работы в рамках лояльности и проч.

![](diagrams/Architecture.png)

# Архитектурное обоснование и описание потоков данных

## Выбор архитектурного стиля: Микросервисы

### Обоснование выбора

1. **Масштабируемость компонентов**
   - Независимое масштабирование сервисов аутентификации, обработки заказов и аналитики
   - Оптимальное распределение ресурсов под нагрузку

2. **Гибкость технологического стека**
   - Возможность использовать разные технологии для разных сервисов
   - Постепенная модернизация компонентов

3. **Повышенная отказоустойчивость**
   - Изоляция сбоев в пределах отдельных сервисов
   - Индивидуальные стратегии восстановления

4. **Соответствие бизнес-доменам**
   - Четкое разделение по бизнес-функциям
   - Каждый сервис отвечает за конкретную бизнес-возможность

## Описание ключевых потоков данных

### 1. Поток аутентификации

**Участники:**
- Клиентское приложение
- API Gateway
- Сервис аутентификации (Auth Service)
- База данных пользователей

**Шаги выполнения:**
1. Клиент → API Gateway: POST /login с учетными данными
2. API Gateway → Auth Service: Передача credentials
3. Auth Service → DB: Верификация пользователя
4. DB → Auth Service: Возврат данных пользователя
5. Auth Service → API Gateway: JWT токен
6. API Gateway → Клиент: Токен доступа

**Особенности:**
- HTTPS-шифрование всех запросов
- Хранение паролей в хэшированном виде
- Временные JWT-токены с ограниченным сроком действия

### 2. Поток обработки заказа

**Участники:**
- Клиентское приложение
- API Gateway
- Сервис заказов (Order Service)
- Платежный сервис (Payment Service)
- Сервис уведомлений (Notification Service)

**Основной сценарий:**
1. Клиент → API Gateway: POST /orders (данные заказа)
2. API Gateway → Order Service: Создание заказа
3. Order Service → Payment Service: Инициация платежа
4. Payment Service → Order Service: Подтверждение оплаты
5. Order Service → Notification Service: Запрос на уведомление
6. Order Service → API Gateway: Подтверждение заказа
7. API Gateway → Клиент: Детали созданного заказа

**Альтернативные сценарии:**
- Отмена заказа
- Возврат платежа
- Обновление статуса доставки

### 3. Поток аналитики

**Участники:**
- Административная панель
- API Gateway
- Аналитический сервис (Analytics Service)
- Хранилище данных

**Процесс формирования отчета:**
1. Администратор → API Gateway: GET /analytics?params
2. API Gateway → Analytics Service: Запрос данных
3. Analytics Service → DB: Агрегация данных
4. DB → Analytics Service: Результаты выборки
5. Analytics Service → API Gateway: Сформированный отчет
6. API Gateway → Администратор: Визуализация данных

**Типы отчетов:**
- Динамика продаж
- ТОП товаров/услуг
- География заказов
- Финансовые метрики

### 4. Поток уведомлений

**Участники:**
- Сервисы-инициаторы (Order, Payment и др.)
- Сервис уведомлений (Notification Service)
- Внешние SMTP/SMS/Push-сервисы

**Процесс отправки:**
1. Сервис-инициатор → Notification Service: Событие
2. Notification Service:
   - Определяет тип уведомления
   - Формирует контент сообщения
   - Выбирает канал доставки
3. Notification Service → Внешние сервисы: Отправка
4. Notification Service: Логирование результата

**Типы уведомлений:**
- Регистрационные
- Статус заказов
- Маркетинговые
- Системные оповещения

Связь и взаимодействие компонентов системы продемонстирована на рисунке ниже. Зеленым цветом обозначены логические границы системы
 
![](diagrams/Sequence_diagram.svg)

## Оплата заказа. Состояния и переходы

![](diagrams/State mashine.png)
